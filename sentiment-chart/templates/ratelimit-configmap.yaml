apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-ratelimit-config
data:
  config.yaml: |
    domain: ratelimit
    descriptors:
    # per-IP limit
    - key: remote_address
      descriptors:
      - key: ""                # match every IP value
        rate_limit:
          unit: minute
          requests_per_unit: {{ .Values.rateLimit.userLimit | default 10 }}

    # fallback per-path limit
    - key: PATH
      rate_limit:
        unit: minute
        requests_per_unit: {{ .Values.rateLimit.globalLimit | default 100 }}